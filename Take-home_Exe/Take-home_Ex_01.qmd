---
title: "Take-Home Exercise 01"
author: "Dew Stella Chan"
date: "2025-02-01"
date-modified: "last-modified"
execute:
  echo: true
  eval: true
  warning: false
  freeze: true
---

# Take Home Exercise 01

This quota document shows the visual analytics conducted for the Take Home Exercise 01, The data set chosen is the [Heart Attack in Japan Youth Vs Adult](https://www.kaggle.com/code/radhikaarajdev/heart-attack-risk-youth-vs-adults-in-japan) from Kaggle.

## Tasks Required

The main task is to develop graphical visuals for a media company on an article for the possible factor leading to heart attack trend in Japanese Youth.

The plan is to carry out exploratory and confirmatory data analysis to confirm the observed trend before doing up the visuals required for the graphic.

Since the goal is to find out if there are any observable trends and health or lifestyle factors leading to the occurance of heart attack in japanese youth, we will be completing filtering the data into 3 main groups for exploretary analysis.

For this analysis we will be definiing Japanese youth as less 35 of age and the rest of the population considered as adults.

1)  group of interest: Youth (15 to 34 https://www.jil.go.jp/english/jli/documents/2023/041-05.pdf (TBC))
2)  youth with no heart attack 3)Adult with heart attack
3)  adult with heart attack.

Given elderly are considered to be above 65, they will be omitted from this study

## Loading of Packages

The following code chunk indicate the list of packages used for this Take Home Exercise 01

```{r}
pacman::p_load(haven, SmartEDA, tidyverse, tidymodels, ggdist, ggridges, ggthemes,
               colorspace, gridExtra, ggstatsplot, GGally, 
               readxl, performance, parameters, see)
```

## Loading of Data

As the data is in csv format, the data is loaded using read_csv function.

```{r}
heart <- read_csv("data/Ex01/japan_heart_attack_dataset.csv")
```

### Data Preparation

summary and head functions are used to view and examin the data type before further processing is carried out.

```{r}
summary(heart)
```

```{r}
head (heart)
```

### Check for missing values.

```{r}
colSums(is.na(heart))
```

As the metadata did not specify the data is of the extra columns hence we will not be able the data in the "Extra_column 1 to 15"

The first step of data preparation is to remove them first.

```{r}
HA <- heart %>% select (1:17) %>% filter (Age < 64)
```

After removing the Extra columns, we continue by examining the data using the summary and head (HA) function.

```{r}
summary(HA)
```

```{r}
head(HA)
```

#### Trasnforming the data to the 4 main sub group.

It was observed that the data consist two main types: namely continous and categorical. The following steps we will examine the distibution of the each type of data in details.

```{r}
HA <- HA %>%
  mutate(Age_Grp = ifelse(Age > 35, "Adult", "Youth")) %>%
  mutate(Event_Grp = ifelse(Age_Grp == "Adult" & Heart_Attack_Occurrence == "Yes", "Adult_HA",
                    ifelse(Age_Grp == "Adult" & Heart_Attack_Occurrence == "No", "Adult_No_HA",
                    ifelse(Age_Grp == "Youth" & Heart_Attack_Occurrence == "Yes", "Youth_HA",
                    ifelse(Age_Grp == "Youth" & Heart_Attack_Occurrence == "No", "Youth_No_HA",NA)))))

HA <- HA %>%
  mutate(BMI_cat = case_when( 
    BMI < 18.5 ~ "Underweight",
    BMI >= 18.5 & BMI < 24.9 ~ "Normal",
    BMI >= 25 & BMI < 29.9 ~ "Overweight",
    BMI >= 30 ~ "Obese",
    TRUE ~ NA_character_
  ))

HA <- HA %>%
  mutate(BP_cat = case_when(
    Systolic_BP < 120 & Diastolic_BP < 80 ~ "Normal",
    (Systolic_BP >= 120 & Systolic_BP < 130) & Diastolic_BP < 80 ~ "Elevated",
    (Systolic_BP >= 130 & Systolic_BP < 140) | (Diastolic_BP >= 80 & Diastolic_BP < 90) ~ "High Stage 1",
    Systolic_BP >= 140 | Diastolic_BP >= 90 ~ "High Stage 2",
    TRUE ~ NA_character_
  ))
HA <- HA %>%
  mutate(Cholesterol_Level_cat = case_when(
    Cholesterol_Level < 200 ~ "Desirable",
    Cholesterol_Level >= 200 & Cholesterol_Level < 239 ~ "Borderline High",
    Cholesterol_Level >= 240 ~ "High",
    TRUE ~ NA_character_
  ))

HA <- HA %>%
  mutate(Stress_Level_cat = case_when(
    Stress_Levels < 3 ~ "Low",
    Stress_Levels >= 3 & Stress_Levels < 6 ~ "Moderate",
    Stress_Levels >= 6 ~ "High",
    TRUE ~ NA_character_
  ))


HA <- HA %>%
  mutate(Heart_Attack_Occurrence_num = ifelse(Heart_Attack_Occurrence == "Yes", 1,
                                              ifelse(Heart_Attack_Occurrence == "No", 0, NA)))

HA <- HA %>% 
  mutate(Heart_Rate_cat = case_when(
    Heart_Rate < 70 ~ "Below Normal",
    Heart_Rate >=  70 & Heart_Rate <= 100 ~ "Normal",
    Heart_Rate  > 100 ~ "Elevated",
    TRUE ~ NA_character_
  ))


```

```{r}
# Removal of NA data 

HA <- HA %>%
  filter(!is.na(BMI_cat) & !is.na(Cholesterol_Level_cat))

```

```{r}
HA_Yes <- filter(HA, Heart_Attack_Occurrence == "Yes")
HA_No <- filter(HA, Heart_Attack_Occurrence == "No")
HA_youth <- filter(HA, Age_Grp == "Youth")
```

### Visualising of categorical Data

The aim of this task is to examine if there are any trends in categorical data in the occurance of heart attack in Japnaese population.

The code below is extract our the categorical data and summarise into the occurance of heart attack

```{r}
categorical_columns <- HA %>% select(where(~is.character(.x) || is.factor(.x)))

count_occurrences <- categorical_columns %>%
  pivot_longer(cols= - c(Heart_Attack_Occurrence, Age_Grp, Event_Grp), names_to = "Category", values_to = "Value") %>%
  group_by(Category, Value, Age_Grp, Heart_Attack_Occurrence, Event_Grp) %>%
  summarise(Occurrences = n(), .groups = 'drop')

print(count_occurrences)
```

```{r}
#| fig-width: 20 #to widen the space
#| fig-height: 16 #to lengthen the graph
# Create bar plots for each categorical field
bar_plots <- count_occurrences %>%
  ggplot(aes(x = Value, y = Occurrences, fill = Event_Grp)) + 
  geom_bar(stat = "identity", position = position_dodge()) +  # Use position_dodge for side-by-side bars
  facet_wrap(~ Category, scales = "free") +
  theme_minimal() +
  labs(title = "Counts of Unique Values in Categorical Fields",
       x = "Unique Values",
       y = "Count") 

# Print the bar plots
print(bar_plots)
```

#### closer examination of categorical trend for those with heart attack

```{r}
#| fig-width: 20 #to widen the space
#| fig-height: 16 #to lengthen the graph
count_occurrences_youth <- filter(count_occurrences, Age_Grp == "Youth")

# Create bar plots for each categorical field
bar_plots <- count_occurrences_youth %>%
  ggplot(aes(x = Value, y = Occurrences, fill = Heart_Attack_Occurrence)) + 
  geom_bar(stat = "identity", position = position_dodge()) +  # Use position_dodge for side-by-side bars
  facet_wrap(~ Category, scales = "free") +
  theme_minimal() +
  labs(title = "Counts of Unique Values in Categorical Fields",
       x = "Unique Values",
       y = "Count") 

# Print the bar plots
print(bar_plots)
```

```{r}
#| fig-width: 24 #to widen the space
#| fig-height: 24 #to lengthen the graph
#pm <- ggpairs(HA, columns = 1:17, ggplot2::aes(colour = Heart_Attack_Occurrence ))
#print (pm)
```

## visualising continuous data

```{r}
# Select only the continuous columns (numeric)
contin_col_HA <- HA %>% select(where(is.numeric), Heart_Attack_Occurrence, Age_Grp)


contin_col_HA_Long<-contin_col_HA %>%
  pivot_longer(cols = -c(Heart_Attack_Occurrence, Age_Grp), names_to = "Field", values_to = "Value")
               
contin_col_HA_Long_Yes <- filter(contin_col_HA_Long, Heart_Attack_Occurrence == "Yes")              
```

```{R}
# Create histograms with density plots for continuous variables
histograms <- ggplot(contin_col_HA_Long, aes(x = Value, fill = Heart_Attack_Occurrence )) + 
  geom_histogram(binwidth = 1, alpha = 0.8) + 
  theme_minimal() + 
  labs(title = "Histograms of Continuous Fields", x = "Value", y = "Frequency")+
  facet_wrap(~ Field, scales = "free") 

# Print the histograms
print(histograms)
```

```{R}
# Create histograms with density plots for continuous variables
histograms <- ggplot(contin_col_HA_Long_Yes, aes(x = Value, fill = Age_Grp )) + 
  geom_histogram(binwidth = 1, alpha = 0.8) + 
  theme_minimal() + 
  labs(title = "Histograms of Continuous Fields", x = "Value", y = "Frequency")+
  facet_wrap(~ Field, scales = "free") 

# Print the histograms
print(histograms)
```

### visualising using density plot

```{r}
# Adding density plot
ggplot(HA, aes(x = Stress_Levels)) +
  geom_histogram(aes(y = ..density..), binwidth = 1, fill = "blue", alpha = 0.5) +
  geom_density(color = "red", size = 1) +
  labs(title = "Histogram and Density Plot of Stress Levels", x = "Stress Levels", y = "Density")
```

### Chi Square

```{r}
ggbarstats(HA, 
           x=Age_Grp,
           y=Heart_Attack_Occurrence)
```

```{r}
ggbarstats(HA, 
           x=Event_Grp,
           y=Region)
```

```{r}
ggbarstats(HA_youth, 
           x= Heart_Attack_Occurrence,
           y=BMI_cat)
```

```{r}

# Select categorical columns
categorical_columns <- HA_youth %>% select(where(~is.character(.) || is.factor(.)))

# Function to perform Chi-Square test and visualize the results
analyze_association <- function(data, x, y) {
  # Perform Chi-Square test
  table <- table(data[[x]], data[[y]])
  chi_test <- chisq.test(table)
  
  # Print Chi-Square test results
  print(paste("Chi-Square Test between", x, "and", y))
  print(chi_test)
  
  # Visualize the results using bar plot
  plot <- ggplot(HA_youth, aes_string(x = x, fill = y)) +
    geom_bar(position = "dodge") +
    labs(title = paste("Bar Plot of", x, "vs", y, "\nChi-Square p-value:", format(chi_test$p.value, digits=4)),
         x = x,
         y = "Count") +
    theme_bw()
  
  print(plot)
}

# Analyze association for each categorical column with Event_Grp
for (column in colnames(categorical_columns)) {
  if (column != "Heart_Attack_Occurrence") { # Skip Event_Grp column itself
    analyze_association(HA_youth, "Heart_Attack_Occurrence", column)
  }
}


```

```{r}

ggplot(HA, aes(x = Stress_Levels, fill = Heart_Attack_Occurrence)) +  # Map fill to Heart_Attack_Occurrence
  geom_histogram(aes(y = ..density..), binwidth = 1, alpha = 0.5, position = "identity") +  # Adjust position for overlap
  geom_density(color = "red", size = 1, alpha = 0.3) +  # Density plot with transparency
  labs(title = "Histogram and Density Plot of Stress Levels",
       x = "Stress Levels",
       y = "Density") +
  theme_minimal(base_size = 14) +  # Improve overall theme and font size
  scale_fill_brewer(palette = "Set2", name = "Heart Attack Occurrence") +  # Use a color palette for filling
  theme(legend.position = "top")  # Position the legend at the top


```

```{r}

# Create individual boxplots for each continuous field
#individual_boxplots <- 
  #ggplot(HA, aes(x = Field, y = Value, fill = Heart_Attack_Occurrence)) +
  #geom_boxplot() +
  #facet_wrap(~ Field, scales = "free") +
  #theme_minimal() +
  #labs(title = "Boxplots of Continuous Fields",
       #x = "Field",
       #y = "Value")

# Print the individual boxplots
#print(individual_boxplots)
```

```{r}
summary(HA_Yes)
```

```{r}
ggplot(data=HA,
       aes(x =  Alcohol_Consumption, y = Cholesterol_Level, color =Heart_Attack_Occurrence )) +
    geom_boxplot()+
  facet_wrap(~ Age_Grp)
```

```{r}

ggplot(data=HA_Yes,
       aes(x = Diet_Quality, y = BMI, color = Age_Grp)) +
    geom_boxplot()+
  facet_wrap(~ Region)

```

```{r}

#| fig-width: 24 #to widen the space
#| fig-height: 24 #to lengthen the graph
ggplot(HA_youth, 
       aes(x = Heart_Attack_Occurrence, y = BMI)) +
  stat_halfeye(adjust = 0.5,
               justification = -0.01,
               .width = 0.01,
               point_colour = NA, 
               size=0.01) +
  geom_boxplot(width = .05,
               outlier.shape = NA) +
  stat_dots(side = "left", 
            justification = 1.2, 
            binwidth = .5,
            dotsize = .1)
```

```{r}
scatter_plot <- ggplot(HA, aes(x = Cholesterol_Level, y = BMI, color = Heart_Attack_Occurrence)) +
  geom_point(size = 2, alpha = 0.5) +  # Adjust point size and transparency
  labs(title = "Scatter Plot of Stress Levels vs. BMI",
       x = "Stress Levels",
       y = "BMI",
       color = "Heart Attack Occurrence") +  # Add title and labels
  theme_minimal(base_size = 14) +  # Use a clean theme with larger base font size
  scale_color_manual(values = c("blue", "red"))  # Customize colors if needed

# Print the scatter plot
print(scatter_plot)

```

```{r}
# Step 1: Select only continuous (numeric) columns along with Heart_Attack_Occurrence
continuous_columns <- HA %>% 
  select(where(is.numeric), Heart_Attack_Occurrence)

# Step 2: Reshape the data to long format
long_data <- continuous_columns %>%
  pivot_longer(-Heart_Attack_Occurrence, names_to = "Variable", values_to = "Value")

# Step 3: Create scatter plots for each continuous variable against Heart_Attack_Occurrence
scatter_plot <- ggplot(long_data, aes(x = Value, y = as.numeric(Heart_Attack_Occurrence), color = Heart_Attack_Occurrence)) +
  geom_point(alpha = 0.7, size = 2) +  # Adjust point size and transparency
  facet_wrap(~ Variable, scales = "free") +  # Create facets for each variable
  labs(title = "Scatter Plots of Continuous Variables by Heart Attack Occurrence",
       x = "Value",
       y = "Heart Attack Occurrence (0 = No, 1 = Yes)") +  # y-axis represents occurrence
  theme_minimal(base_size = 14) +  # Clean theme
  scale_color_manual(values = c("blue", "red"))  # Customize colors for heart attack occurrence

# Print the scatter plots
print(scatter_plot)

# Print the scatter plots
print(scatter_plot)
```

### Inspiration

```{r}
ggplot(HA, aes(x = Smoking_History, fill = Heart_Attack_Occurrence)) +
  geom_bar(position = "fill") +
  labs(title = "Smoking History vs Heart Attack Occurrence", 
       y = "Proportion", 
       x = "Smoking History") +
  scale_fill_manual(values = c("lightblue", "salmon"), name = "Heart Attack Occurrence")
```

### Anova

```{r}
ggbetweenstats(
  data = HA_youth,
  x = Heart_Attack_Occurrence, 
  y = Stress_Levels,
  type = "p",
  mean.ci = TRUE, 
  pairwise.comparisons = TRUE, 
  pairwise.display = "s",
  p.adjust.method = "fdr",
  messages = FALSE
)
```

```{r}
ggbetweenstats(
  data = HA_youth,
  x = Heart_Attack_Occurrence, 
  y = BMI,
  type = "p",
  mean.ci = TRUE, 
  pairwise.comparisons = TRUE, 
  pairwise.display = "s",
  p.adjust.method = "fdr",
  messages = FALSE
)
```



::: callout-note

The very small effect size (Hedges' g = 0.04) suggests that although the difference is statistically significant, it may not be practically relevant. In other words, the difference in means may not be large enough to have meaningful implications in a real-world context.

:::

### Model building

```{r}
model <- lm(Heart_Attack_Occurrence_num ~ Cholesterol_Level_cat + BMI_cat + Diabetes_History, data = HA_youth)
model

```

```{r}
check_n <- check_normality(model)
plot(check_n)
```

```{r}
check_h <- check_heteroscedasticity(model)

plot(check_h)
```

```{r}
check_model(model)

```

### Conclusion:

The health crsis of heart attack is largely depended on the possibility
