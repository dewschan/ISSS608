{
  "hash": "c67d3fa6cabec0c97247040aa0b92763",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Hands-on Ex 07\"\nauthor: \"Dew Stella Chan\"\ndate: \"2025-02-23\"\ndate-modified: \"last-modified\"\nexecute:\n  echo: true\n  eval: true\n  warning: false\n  freeze: true\n---\n\n\n\n\n### Visualising and Analysing Time-oriented Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(rootSolve, lmom, expm, Exact, gld, productplots, libcoin, inum, \n                 DescTools, ggmosaic, partykit, CGPfunctions, knitr, tidyverse,\n               data.table, dplyr,ggthemes, readxl )\n```\n:::\n\n\n\n### Plotting Calender Heatmap \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nattacks <- read.csv(\"data/eventlog.csv\")\n```\n:::\n\n\n\n### Examining the data structure\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkable(head(attacks))\n```\n\n::: {.cell-output-display}\n\n\n|timestamp                   |source_country |tz              |\n|:---------------------------|:--------------|:---------------|\n|2015-03-12T15:59:16.718901Z |CN             |Asia/Shanghai   |\n|2015-03-12T16:00:48.841746Z |FR             |Europe/Paris    |\n|2015-03-12T16:02:26.731256Z |CN             |Asia/Shanghai   |\n|2015-03-12T16:02:38.469907Z |US             |America/Chicago |\n|2015-03-12T16:03:22.201903Z |CN             |Asia/Shanghai   |\n|2015-03-12T16:03:45.984616Z |CN             |Asia/Shanghai   |\n\n\n:::\n:::\n\n\n### Data Preparation\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmake_hr_wkday <- function(ts, sc, tz) {\n  real_times <- ymd_hms(ts, \n                        tz = tz[1], \n                        quiet = TRUE)\n  dt <- data.table(source_country = sc,\n                   wkday = weekdays(real_times),\n                   hour = hour(real_times))\n  return(dt)\n  }\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwkday_levels <- c('Saturday', 'Friday', \n                  'Thursday', 'Wednesday', \n                  'Tuesday', 'Monday', \n                  'Sunday')\n\nattacks <- attacks %>%\n  group_by(tz) %>%\n  do(make_hr_wkday(.$timestamp, \n                   .$source_country, \n                   .$tz)) %>% \n  ungroup() %>% \n  mutate(wkday = factor(\n    wkday, levels = wkday_levels),\n    hour  = factor(\n      hour, levels = 0:23))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngrouped <- attacks %>% \n  count(wkday, hour) %>% \n  ungroup() %>%\n  na.omit()\n\nggplot(grouped, \n       aes(hour, \n           wkday, \n           fill = n)) + \ngeom_tile(color = \"white\", \n          size = 0.1) + \ntheme_tufte(base_family = \"Helvetica\") + \ncoord_equal() +\nscale_fill_gradient(name = \"# of attacks\",\n                    low = \"sky blue\", \n                    high = \"dark blue\") +\nlabs(x = NULL, \n     y = NULL, \n     title = \"Attacks by weekday and time of day\") +\ntheme(axis.ticks = element_blank(),\n      plot.title = element_text(hjust = 0.5),\n      legend.title = element_text(size = 8),\n      legend.text = element_text(size = 6) )\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex_07_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n### Building Multiple Calendar Heatmaps\n\n#### Using different from code from prof kam \n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop4 <- attacks %>%\n  count(source_country, wkday, hour) %>%\n  group_by(source_country) %>%\n  summarise(total_attacks = sum(n)) %>%\n  top_n(4, total_attacks) %>%\n  arrange(desc(total_attacks))\n\ngrouped_top4 <- attacks %>%\n  count(source_country, wkday, hour) %>% \n  ungroup() %>%\n  na.omit() %>%\n  semi_join(top4, by = \"source_country\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(grouped_top4, \n       aes(hour, \n           wkday, \n           fill = n)) + \ngeom_tile(color = \"white\", \n          size = 0.1) + \ntheme_tufte(base_family = \"Helvetica\") + \ncoord_equal() +\nscale_fill_gradient(name = \"# of attacks\",\n                    low = \"sky blue\", \n                    high = \"dark blue\") +\nfacet_wrap(~source_country)+\nlabs(x = NULL, \n     y = NULL, \n     title = \"Attacks by weekday and time of day\") +\ntheme(axis.ticks = element_blank(),\n      axis.text.x = element_text(size = 7),\n      plot.title = element_text(hjust = 0.5),\n      legend.title = element_text(size = 8),\n      legend.text = element_text(size = 6) ) \n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex_07_files/figure-html/unnamed-chunk-8-1.png){width=1152}\n:::\n:::\n\n\n\n### Plotting Cycle Plot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nair <- read_excel(\"data/arrivals_by_air.xlsx\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nair$month <- factor(month(air$`Month-Year`), \n                    levels=1:12, \n                    labels=month.abb, \n                    ordered=TRUE) \nair$year <- year(ymd(air$`Month-Year`))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nVietnam <- air %>% \n  select(`Vietnam`, \n         month, \n         year) %>%\n  filter(year >= 2010)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhline.data <- Vietnam %>% \n  group_by(month) %>%\n  summarise(avgvalue = mean(`Vietnam`))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_line(data=Vietnam,\n            aes(x=year, \n                y=`Vietnam`, \n                group=month), \n            colour=\"black\") +\n  geom_hline(aes(yintercept=avgvalue), \n             data=hline.data, \n             linetype=6, \n             colour=\"red\", \n             size=0.5) + \n  facet_grid(~month) +\n  labs(axis.text.x = element_blank(),\n       title = \"Visitor arrivals from Vietnam by air, Jan 2010-Dec 2019\") +\n  xlab(\"\") +\n  ylab(\"No. of Visitors\") +\n  theme_economist_white()\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex_07_files/figure-html/unnamed-chunk-13-1.png){width=1920}\n:::\n:::\n\n\n\n\n### Plotting Slopegraph\n\nStep 1: Data Import\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrice <- read_csv(\"data/rice.csv\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrice %>% \n  mutate(Year = factor(Year)) %>%\n  filter(Year %in% c(1961, 1980)) %>%\n  newggslopegraph(Year, Yield, Country,\n                Title = \"Rice Yield of Top 11 Asian Counties\",\n                SubTitle = \"1961-1980\",\n                Caption = \"Referred to codes by: Dr. Kam Tin Seong\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex_07_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Hands-on_Ex_07_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}